<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1">
    <title>Treasure Quest - Retro Adventure</title>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            background: #000;
            font-family: monospace;
            color: #fff;
            height: 100%;
            width: 100%;
            overflow: hidden;
            touch-action: none;
        }
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            min-width: 100vw;
        }
        #gameContainer {
            border: 2px solid #00ff00;
            background: #001100;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100vw;
            max-width: 100vw;
            box-sizing: border-box;
        }
        #gameCanvas {
            display: block;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
            width: 100vw;
            height: auto;
            max-width: 100vw;
            max-height: 60vh;
            background: #000;
            margin: 0 auto;
        }
        #ui {
            background: #000;
            color: #00ff00;
            padding: 10px 0 0 0;
            font-size: 16px;
            border-top: 2px solid #00ff00;
            width: 100vw;
            box-sizing: border-box;
            text-align: center;
        }
        #controls {
            margin: 12px 0 0 0;
            display: grid;
            grid-template-columns: repeat(3, 70px);
            grid-gap: 10px;
            justify-content: center;
            align-items: center;
            width: 100vw;
            max-width: 260px;
            margin-left: auto;
            margin-right: auto;
        }
        .control-btn {
            width: 70px;
            height: 70px;
            background: #003300;
            border: 2px solid #00ff00;
            color: #00ff00;
            font-size: 22px;
            font-weight: bold;
            cursor: pointer;
            user-select: none;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 14px;
            touch-action: manipulation;
        }
        .control-btn:active {
            background: #006600;
        }
        #inventory {
            margin-top: 14px;
            display: flex;
            gap: 8px;
            justify-content: center;
            flex-wrap: wrap;
        }
        .item {
            width: 36px;
            height: 36px;
            border: 1.5px solid #00ff00;
            background: #002200;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }
        @media (max-width: 600px) {
            #gameCanvas {
                max-width: 100vw;
                max-height: 45vh;
            }
            #controls {
                grid-template-columns: repeat(3, 1fr);
                max-width: 100vw;
            }
            #ui {
                font-size: 14px;
            }
            .control-btn {
                width: 52px;
                height: 52px;
                font-size: 18px;
            }
            .item {
                width: 26px;
                height: 26px;
                font-size: 13px;
            }
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas" width="320" height="240"></canvas>
        <div id="ui">
            <div>Level: <span id="level">1</span> | Health: <span id="health">100</span> | Score: <span id="score">0</span></div>
            <div>Items: <span id="itemCount">0</span>/5</div>
            <div id="message">Find all 5 treasures to advance! Use arrow keys or touch controls.</div>
            <div id="controls">
                <div></div>
                <div class="control-btn" data-key="up">↑</div>
                <div></div>
                <div class="control-btn" data-key="left">←</div>
                <div class="control-btn" data-key="down">↓</div>
                <div class="control-btn" data-key="right">→</div>
                <div></div>
                <div class="control-btn" data-key="action">⎵</div>
                <div></div>
            </div>
            <div id="inventory"></div>
        </div>
    </div>
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const BASE_WIDTH = 320, BASE_HEIGHT = 240;
        // Responsively resize canvas to fit window while keeping aspect ratio
        function resizeCanvas() {
            let w = window.innerWidth;
            let h = Math.min(window.innerHeight, window.innerWidth * (BASE_HEIGHT/BASE_WIDTH));
            let scale = Math.min(w / BASE_WIDTH, h / BASE_HEIGHT, 2);
            canvas.style.width = Math.floor(BASE_WIDTH * scale) + 'px';
            canvas.style.height = Math.floor(BASE_HEIGHT * scale) + 'px';
        }
        window.addEventListener('resize', resizeCanvas);
        window.addEventListener('orientationchange', resizeCanvas);
        resizeCanvas();

        // Game state
        const game = {
            player: { x: 50, y: 100, health: 100, score: 0 },
            items: [],
            enemies: [],
            walls: [],
            treasures: [],
            inventory: [],
            keys: {},
            message: "Find all 5 treasures to advance!",
            gameWon: false,
            level: 1,
            maxLevel: 3,
            levelComplete: false
        };
        // ... (rest of your original JS code goes here, unchanged) ...
        // (Paste your original JavaScript logic below this section, unmodified except as noted.)

        // === Rest of your original JS code unchanged ===
        // ... (copy ALL your game logic here as is) ...

        // --- Insert your entire game JS code here as in your original post ---
        // (your original code from "const colors = ..." down to gameLoop();)

        // (For brevity, I'm not repeating your entire code block here, but include all your JS logic as in your current file.)

        // Add this after your gameLoop() call:
        // Prevent double-tap zoom on iOS
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function(event) {
            let now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);
    </script>
</body>
</html>
