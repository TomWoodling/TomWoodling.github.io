<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brilliant Conversations - Card Game Prototype</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #333;
        }

        .game-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 1200px;
            width: 90%;
        }

        h1 {
            text-align: center;
            color: #764ba2;
            margin-bottom: 20px;
            font-size: 2em;
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            padding: 15px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border-radius: 10px;
            color: white;
        }

        .action-points {
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 12px;
            border-radius: 8px;
            font-weight: bold;
        }

        .battle-area {
            display: grid;
            grid-template-columns: 1fr 150px 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .player-area, .opponent-area {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .player-name {
            font-weight: bold;
            font-size: 1.2em;
            margin-bottom: 10px;
            text-align: center;
        }

        .health-bar {
            background: #e0e0e0;
            height: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            overflow: hidden;
        }

        .health-fill {
            height: 100%;
            background: linear-gradient(90deg, #56CCF2, #2F80ED);
            transition: width 0.3s ease;
        }

        .battle-log {
            background: #f0f0f0;
            border-radius: 10px;
            padding: 10px;
            height: 150px;
            overflow-y: auto;
            font-size: 0.9em;
            margin-bottom: 10px;
        }

        .cards-container {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            min-height: 180px;
        }

        .card {
            background: white;
            border: 3px solid #667eea;
            border-radius: 10px;
            padding: 10px;
            width: 120px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .card.selected {
            border-color: #f5576c;
            background: #fff0f3;
            transform: scale(1.05);
        }

        .card.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .card.no-action-points {
            opacity: 0.6;
            cursor: not-allowed;
            border-color: #ccc;
        }

        .card-emoji {
            font-size: 2.5em;
            text-align: center;
            margin-bottom: 5px;
        }

        .card-name {
            font-weight: bold;
            text-align: center;
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .card-level {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #764ba2;
            color: white;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8em;
            font-weight: bold;
        }

        .card-stats {
            display: flex;
            justify-content: space-around;
            font-size: 0.8em;
            margin-top: 5px;
        }

        .stat {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .stat-icon {
            font-size: 1.2em;
        }

        .controls {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        button:hover:not(:disabled) {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(118, 75, 162, 0.4);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .stage-select {
            text-align: center;
            margin-bottom: 20px;
        }

        .stage-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 10px;
        }

        .stage-btn {
            padding: 8px 15px;
            font-size: 0.9em;
        }

        .stage-btn.completed {
            background: linear-gradient(135deg, #56CCF2, #2F80ED);
        }

        .turn-indicator {
            text-align: center;
            padding: 10px;
            background: #f0f0f0;
            border-radius: 10px;
            font-weight: bold;
        }

        @keyframes cardPlay {
            0% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.2) rotate(5deg); }
            100% { transform: scale(1) rotate(0deg); }
        }

        .playing {
            animation: cardPlay 0.5s ease;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>üåü Brilliant Conversations üåü</h1>
        
        <div class="stage-select">
            <div>Select Stage:</div>
            <div class="stage-buttons">
                <button class="stage-btn" onclick="game.startStage(1)">1: Cave Door</button>
                <button class="stage-btn" onclick="game.startStage(2)">2: Genie</button>
                <button class="stage-btn" onclick="game.startStage(3)">3: Merchant</button>
                <button class="stage-btn" onclick="game.startStage(4)">4: Dragon</button>
                <button class="stage-btn" onclick="game.startStage(5)">5: Wizard</button>
            </div>
        </div>

        <div class="game-info">
            <div>Stage: <span id="current-stage">1</span></div>
            <div>Turn: <span id="turn-count">1</span></div>
            <div class="action-points">Action Points: <span id="action-points">2</span>/2</div>
            <div>Brilliance Score: <span id="brilliance">0</span></div>
        </div>

        <div class="battle-area">
            <div class="player-area">
                <div class="player-name">Feetz (You)</div>
                <div class="health-bar">
                    <div class="health-fill" id="player-health" style="width: 100%"></div>
                </div>
                <div class="cards-container" id="player-hand"></div>
            </div>

            <div class="turn-indicator" id="turn-indicator">
                Your Turn
            </div>

            <div class="opponent-area">
                <div class="player-name" id="opponent-name">Cave Door</div>
                <div class="health-bar">
                    <div class="health-fill" id="opponent-health" style="width: 100%"></div>
                </div>
                <div class="cards-container" id="opponent-hand"></div>
            </div>
        </div>

        <div class="battle-log" id="battle-log">
            Welcome to Brilliant Conversations! Select a stage to begin.
        </div>

        <div class="controls">
            <button onclick="game.playTurn()" id="play-btn">Play Card</button>
            <button onclick="game.endTurn()" id="end-turn-btn">End Turn</button>
            <button onclick="game.reset()">New Game</button>
        </div>
    </div>

    <script>
        class Card {
            constructor(name, emoji, level = 1) {
                this.name = name;
                this.emoji = emoji;
                this.level = level;
                this.maxBrilliance = level * 2 + (Math.random() > 0.5 ? 1 : -1);
                this.brilliance = this.maxBrilliance;
                
                // Shared pool for question/joke
                const pool = level * 2 + 3;
                this.question = Math.floor(Math.random() * (pool - 1)) + 1;
                this.joke = pool - this.question;
                
                // Extra attributes for higher levels
                this.attributes = level >= 5 ? 3 : (level >= 3 ? 2 : 1);
            }

            takeDamage(amount) {
                this.brilliance = Math.max(0, this.brilliance - amount);
            }

            isExhausted() {
                return this.brilliance <= 0;
            }
        }

        class Game {
            constructor() {
                this.cardDefinitions = [
                    { name: 'Tree', emoji: 'üå≥' },
                    { name: 'Rainbow', emoji: 'üåà' },
                    { name: 'Potion', emoji: 'üß™' },
                    { name: 'Wrench', emoji: 'üîß' },
                    { name: 'Magic Lamp', emoji: 'ü™î' },
                    { name: 'Genie', emoji: 'üßû' },
                    { name: 'Castle', emoji: 'üè∞' },
                    { name: 'Merchant', emoji: 'üßë‚Äçüíº' },
                    { name: 'Mountain', emoji: '‚õ∞Ô∏è' },
                    { name: 'Dragon', emoji: 'üêâ' }
                ];
                
                this.stages = {
                    1: { name: 'Cave Door', availableCards: 4, playerLevel: 1, opponentLevel: 1 },
                    2: { name: 'Genie', availableCards: 6, playerLevel: 2, opponentLevel: 2 },
                    3: { name: 'Merchant', availableCards: 8, playerLevel: 3, opponentLevel: 3 },
                    4: { name: 'Dragon', availableCards: 10, playerLevel: 4, opponentLevel: 4 },
                    5: { name: 'Mystery Wizard', availableCards: 10, playerLevel: 5, opponentLevel: 5 }
                };
                
                this.currentStage = 1;
                this.turn = 1;
                this.playerTurn = true;
                this.selectedCard = null;
                this.playerHand = [];
                this.opponentHand = [];
                this.playerHealth = 100;
                this.opponentHealth = 100;
                this.brillianceScore = 0;
                this.completedStages = [];
                this.actionPoints = 2;
                this.maxActionPoints = 2;
            }

            startStage(stageNum) {
                this.currentStage = stageNum;
                const stage = this.stages[stageNum];
                
                document.getElementById('current-stage').textContent = stageNum;
                document.getElementById('opponent-name').textContent = stage.name;
                this.turn = 1;
                document.getElementById('turn-count').textContent = this.turn;
                
                this.playerHealth = 100;
                this.opponentHealth = 100;
                this.actionPoints = this.maxActionPoints;
                this.updateActionPoints();
                this.updateHealthBars();
                
                // Generate hands
                this.playerHand = this.generateHand(stage.playerLevel, stage.availableCards, stageNum);
                this.opponentHand = this.generateOpponentHand(stage.opponentLevel, stage.availableCards, stageNum);
                
                this.renderHands();
                this.playerTurn = true;
                this.selectedCard = null;
                this.updateTurnIndicator();
                
                this.addLog(`Stage ${stageNum}: ${stage.name} appears!`);
                this.addLog(`The conversation begins...`);
            }

            generateHand(level, maxCardIndex, stageNum) {
                const hand = [];
                const cardCount = 5;
                
                for (let i = 0; i < cardCount; i++) {
                    let cardIndex;
                    if (stageNum === 1) {
                        // Stage 1: specific cards for tutorial
                        cardIndex = [1, 2, 3][i % 3]; // Rainbow, Potion, Wrench
                    } else {
                        cardIndex = Math.floor(Math.random() * maxCardIndex);
                    }
                    
                    const cardDef = this.cardDefinitions[cardIndex];
                    const cardLevel = Math.min(level, Math.floor(Math.random() * level) + 1);
                    hand.push(new Card(cardDef.name, cardDef.emoji, cardLevel));
                }
                
                return hand;
            }

            generateOpponentHand(level, maxCardIndex, stageNum) {
                const hand = [];
                const cardCount = stageNum === 1 ? 2 : 5; // Door only has 2 cards
                
                for (let i = 0; i < cardCount; i++) {
                    let cardIndex;
                    
                    if (stageNum === 1) {
                        cardIndex = 0; // Only trees for door
                    } else if (stageNum === 2) {
                        // Genie can't draw magic lamp
                        do {
                            cardIndex = Math.floor(Math.random() * maxCardIndex);
                        } while (cardIndex === 4);
                    } else if (stageNum === 3) {
                        // Merchant always has one castle
                        cardIndex = i === 0 ? 6 : Math.floor(Math.random() * maxCardIndex);
                    } else if (stageNum === 4) {
                        // Dragon always has itself
                        cardIndex = i === 0 ? 9 : Math.floor(Math.random() * maxCardIndex);
                    } else {
                        cardIndex = Math.floor(Math.random() * maxCardIndex);
                    }
                    
                    const cardDef = this.cardDefinitions[cardIndex];
                    const cardLevel = Math.min(level, Math.floor(Math.random() * level) + 1);
                    hand.push(new Card(cardDef.name, cardDef.emoji, cardLevel));
                }
                
                return hand;
            }

            renderHands() {
                // Render player hand
                const playerContainer = document.getElementById('player-hand');
                playerContainer.innerHTML = '';
                
                this.playerHand.forEach((card, index) => {
                    if (!card.isExhausted()) {
                        const cardEl = this.createCardElement(card, index, true);
                        playerContainer.appendChild(cardEl);
                    }
                });
                
                // Render opponent hand (face down or revealed)
                const opponentContainer = document.getElementById('opponent-hand');
                opponentContainer.innerHTML = '';
                
                this.opponentHand.forEach((card, index) => {
                    if (!card.isExhausted()) {
                        const cardEl = this.createCardElement(card, index, false);
                        opponentContainer.appendChild(cardEl);
                    }
                });
            }

            createCardElement(card, index, isPlayer) {
                const div = document.createElement('div');
                div.className = 'card';
                
                if (isPlayer && this.playerTurn) {
                    if (this.actionPoints > 0) {
                        div.onclick = () => this.selectCard(index);
                        if (this.selectedCard === index) {
                            div.classList.add('selected');
                        }
                    } else {
                        div.classList.add('no-action-points');
                    }
                } else if (!isPlayer) {
                    div.classList.add('disabled');
                }
                
                div.innerHTML = `
                    <div class="card-level">${card.level}</div>
                    <div class="card-emoji">${card.emoji}</div>
                    <div class="card-name">${card.name}</div>
                    <div class="card-stats">
                        <div class="stat">
                            <span class="stat-icon">üí´</span>
                            <span>${card.brilliance}/${card.maxBrilliance}</span>
                        </div>
                        <div class="stat">
                            <span class="stat-icon">‚ùì</span>
                            <span>${card.question}</span>
                        </div>
                        <div class="stat">
                            <span class="stat-icon">üòÑ</span>
                            <span>${card.joke}</span>
                        </div>
                    </div>
                `;
                
                return div;
            }

            selectCard(index) {
                if (!this.playerTurn || this.actionPoints <= 0) return;
                this.selectedCard = this.selectedCard === index ? null : index;
                this.renderHands();
            }

            playTurn() {
                if (!this.playerTurn || this.selectedCard === null || this.actionPoints <= 0) {
                    if (this.actionPoints <= 0) {
                        this.addLog("No action points left! End your turn.");
                    } else {
                        this.addLog("Select a card first!");
                    }
                    return;
                }
                
                const playerCard = this.playerHand[this.selectedCard];
                
                // Simple AI - pick random opponent card
                const validOpponentCards = this.opponentHand.filter(c => !c.isExhausted());
                if (validOpponentCards.length === 0) {
                    this.win();
                    return;
                }
                
                const opponentCard = validOpponentCards[Math.floor(Math.random() * validOpponentCards.length)];
                
                // Battle calculation
                const playerDamage = playerCard.question - opponentCard.joke;
                const opponentDamage = opponentCard.question - playerCard.joke;
                
                if (playerDamage > 0) {
                    opponentCard.takeDamage(playerDamage);
                    this.opponentHealth -= playerDamage * 2;
                    this.addLog(`${playerCard.name} asks a brilliant question! ${opponentCard.name} loses ${playerDamage} brilliance!`);
                } else {
                    this.addLog(`${opponentCard.name} laughs off the question!`);
                }
                
                if (opponentDamage > 0 && !opponentCard.isExhausted()) {
                    playerCard.takeDamage(opponentDamage);
                    this.playerHealth -= opponentDamage * 2;
                    this.addLog(`${opponentCard.name} counters! ${playerCard.name} loses ${opponentDamage} brilliance!`);
                } else if (!opponentCard.isExhausted()) {
                    this.addLog(`${playerCard.name} deflects with humor!`);
                }
                
                // Cards lose 1 brilliance per turn
                playerCard.takeDamage(1);
                opponentCard.takeDamage(1);
                
                this.brillianceScore += playerCard.level * 10;
                document.getElementById('brilliance').textContent = this.brillianceScore;
                
                // Use action point
                this.actionPoints--;
                this.updateActionPoints();
                
                this.updateHealthBars();
                this.selectedCard = null;
                this.renderHands();
                
                if (this.opponentHealth <= 0) {
                    this.win();
                } else if (this.playerHealth <= 0) {
                    this.lose();
                }
            }

            endTurn() {
                if (!this.playerTurn) return;
                
                this.playerTurn = false;
                this.turn++;
                document.getElementById('turn-count').textContent = this.turn;
                this.updateTurnIndicator();
                this.selectedCard = null; // Clear selection
                
                // AI turn
                setTimeout(() => {
                    this.aiTurn();
                }, 1000);
            }

            aiTurn() {
                const validOpponentCards = this.opponentHand.filter(c => !c.isExhausted());
                const validPlayerCards = this.playerHand.filter(c => !c.isExhausted());
                
                if (validOpponentCards.length === 0 || validPlayerCards.length === 0) {
                    if (validOpponentCards.length === 0) this.win();
                    else this.lose();
                    return;
                }
                
                // Stage 5 wizard "cheats" sometimes
                if (this.currentStage === 5 && Math.random() > 0.7) {
                    this.addLog("The Wizard uses mysterious magic!");
                    const cheatCard = validOpponentCards[0];
                    cheatCard.question += 3;
                    cheatCard.brilliance = cheatCard.maxBrilliance;
                }
                
                const opponentCard = validOpponentCards[Math.floor(Math.random() * validOpponentCards.length)];
                const playerCard = validPlayerCards[Math.floor(Math.random() * validPlayerCards.length)];
                
                this.addLog(`${this.stages[this.currentStage].name} plays ${opponentCard.name}!`);
                
                const damage = opponentCard.question - playerCard.joke;
                if (damage > 0) {
                    playerCard.takeDamage(damage);
                    this.playerHealth -= damage * 2;
                    this.addLog(`Your ${playerCard.name} loses ${damage} brilliance!`);
                }
                
                opponentCard.takeDamage(1);
                
                this.updateHealthBars();
                this.renderHands();
                
                if (this.playerHealth <= 0) {
                    this.lose();
                } else {
                    // Return to player turn
                    this.playerTurn = true;
                    this.actionPoints = this.maxActionPoints; // Reset action points
                    this.updateActionPoints();
                    this.selectedCard = null; // Ensure no card is pre-selected
                    this.updateTurnIndicator();
                    this.renderHands(); // Re-render to make cards clickable
                }
            }

            updateTurnIndicator() {
                const indicator = document.getElementById('turn-indicator');
                indicator.textContent = this.playerTurn ? "Your Turn" : "Opponent's Turn";
                indicator.style.background = this.playerTurn ? "#e8f5e9" : "#ffebee";
            }

            updateActionPoints() {
                document.getElementById('action-points').textContent = this.actionPoints;
            }

            updateHealthBars() {
                document.getElementById('player-health').style.width = Math.max(0, this.playerHealth) + '%';
                document.getElementById('opponent-health').style.width = Math.max(0, this.opponentHealth) + '%';
            }

            win() {
                this.addLog(`üéâ Brilliant! You convinced ${this.stages[this.currentStage].name}!`);
                this.completedStages.push(this.currentStage);
                this.updateStageButtons();
                document.getElementById('play-btn').disabled = true;
                document.getElementById('end-turn-btn').disabled = true;
            }

            lose() {
                this.addLog(`üíî ${this.stages[this.currentStage].name} wasn't convinced. Try again!`);
                document.getElementById('play-btn').disabled = true;
                document.getElementById('end-turn-btn').disabled = true;
            }

            updateStageButtons() {
                const buttons = document.querySelectorAll('.stage-btn');
                buttons.forEach((btn, index) => {
                    if (this.completedStages.includes(index + 1)) {
                        btn.classList.add('completed');
                    }
                });
            }

            addLog(message) {
                const log = document.getElementById('battle-log');
                log.innerHTML = `<div>${message}</div>` + log.innerHTML;
            }

            reset() {
                this.brillianceScore = 0;
                document.getElementById('brilliance').textContent = 0;
                document.getElementById('play-btn').disabled = false;
                document.getElementById('end-turn-btn').disabled = false;
                this.actionPoints = this.maxActionPoints;
                this.updateActionPoints();
                this.startStage(1);
            }
        }

        const game = new Game();
        // Start with stage 1 by default
        game.startStage(1);
    </script>
</body>
</html>